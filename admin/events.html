<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFW Vedanta - Events Manager</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .header { background: #FF9933; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 1.5rem; }
        .nav-links { display: flex; gap: 1rem; }
        .nav-links a { color: white; text-decoration: none; padding: 0.5rem 1rem; background: rgba(255,255,255,0.2); border-radius: 4px; }
        .nav-links a:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1.5rem; }
        .card h2 { margin-bottom: 1rem; color: #333; display: flex; align-items: center; gap: 0.5rem; }
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #555; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 500; }
        .btn-primary { background: #FF9933; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-sm { padding: 0.4rem 0.75rem; font-size: 0.85rem; }
        .btn:hover { opacity: 0.9; }
        .event-list { max-height: 500px; overflow-y: auto; }
        .event-item { padding: 1rem; border: 1px solid #eee; border-radius: 6px; margin-bottom: 0.75rem; position: relative; }
        .event-item h3 { font-size: 1rem; margin-bottom: 0.5rem; color: #333; }
        .event-item p { font-size: 0.85rem; color: #666; margin-bottom: 0.25rem; }
        .event-item .event-date { color: #FF9933; font-weight: 600; }
        .event-item .actions { position: absolute; top: 1rem; right: 1rem; display: flex; gap: 0.5rem; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; background: #e9ecef; }
        .badge-upcoming { background: #d4edda; color: #155724; }
        .badge-past { background: #f8d7da; color: #721c24; }
        .status { padding: 1rem; background: #e9ecef; text-align: center; margin-top: 1rem; border-radius: 4px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .loading { text-align: center; padding: 2rem; color: #666; }
        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üïâÔ∏è DFW Vedanta - Events Manager</h1>
        <div class="nav-links">
            <a href="editor.html">üìù Code Editor</a>
            <a href="https://v2-sigma-two.vercel.app" target="_blank">üåê View Site</a>
        </div>
    </div>
    
    <div class="container">
        <div class="card">
            <h2>‚ûï Add New Event</h2>
            <form id="eventForm">
                <div class="form-group">
                    <label>Event Title *</label>
                    <input type="text" id="title" required placeholder="e.g., Shivaratri Puja">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date *</label>
                        <input type="date" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label>End Date *</label>
                        <input type="date" id="endDate" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" id="startTime" value="18:00">
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" id="endTime" value="21:00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Event Type</label>
                    <select id="eventType">
                        <option value="Puja">Puja</option>
                        <option value="Retreat">Retreat</option>
                        <option value="Lecture">Lecture</option>
                        <option value="Service">Service / Food Drive</option>
                        <option value="Special">Special Event</option>
                        <option value="Workshop">Workshop</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Location</label>
                    <select id="location">
                        <option value="In Person">In Person</option>
                        <option value="Online">Online Only</option>
                        <option value="Hybrid">In Person & Online</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Zoom Link (if online)</label>
                    <input type="url" id="zoomLink" placeholder="https://us02web.zoom.us/j/...">
                </div>
                
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="description" required placeholder="Describe the event..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width:100%">üíæ Save Event</button>
            </form>
            <div id="formStatus" class="status" style="display:none;"></div>
        </div>
        
        <div class="card">
            <h2>üìÖ Current Events</h2>
            <div id="eventList" class="event-list">
                <div class="loading">Loading events...</div>
            </div>
        </div>
    </div>

    <script>
        let events = [];
        let eventsFileSha = null;
        let githubToken = localStorage.getItem('github_token');
        const REPO = 'vinaysolapurkar/vedantadfw';
        const BRANCH = 'master';
        const EVENTS_FILE = 'v2/content/events.json';
        
        if (!githubToken) {
            githubToken = prompt('GitHub Personal Access Token (needs repo scope):');
            if (githubToken) localStorage.setItem('github_token', githubToken);
        }
        
        // Load events on page load
        loadEvents();
        
        // Form submit
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await addEvent();
        });
        
        async function loadEvents() {
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO}/contents/${EVENTS_FILE}?ref=${BRANCH}`, {
                    headers: githubToken ? { 'Authorization': `token ${githubToken}` } : {}
                });
                
                if (response.ok) {
                    const data = await response.json();
                    eventsFileSha = data.sha;
                    events = JSON.parse(atob(data.content));
                } else if (response.status === 404) {
                    // File doesn't exist, create empty
                    events = [];
                } else {
                    throw new Error('Failed to load events');
                }
                
                renderEvents();
            } catch (error) {
                document.getElementById('eventList').innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
            }
        }
        
        function renderEvents() {
            const now = new Date();
            const list = document.getElementById('eventList');
            
            if (events.length === 0) {
                list.innerHTML = '<p style="color:#666;text-align:center;">No events yet. Add your first event!</p>';
                return;
            }
            
            // Sort by date (newest first)
            const sorted = [...events].sort((a, b) => new Date(b.startDate) - new Date(a.startDate));
            
            list.innerHTML = sorted.map((event, index) => {
                const eventDate = new Date(event.endDate + 'T' + (event.endTime || '23:59'));
                const isPast = eventDate < now;
                const originalIndex = events.indexOf(event);
                
                return `
                    <div class="event-item">
                        <div class="actions">
                            <button class="btn btn-danger btn-sm" onclick="deleteEvent(${originalIndex})">üóëÔ∏è</button>
                        </div>
                        <span class="badge ${isPast ? 'badge-past' : 'badge-upcoming'}">${isPast ? 'Past' : 'Upcoming'}</span>
                        <h3>${event.title}</h3>
                        <p class="event-date">üìÖ ${formatDate(event.startDate)} ${event.startTime || ''} - ${event.endTime || ''}</p>
                        <p>üìç ${event.location || 'In Person'} ${event.eventType ? '‚Ä¢ ' + event.eventType : ''}</p>
                        ${event.zoomLink ? `<p>üîó <a href="${event.zoomLink}" target="_blank">Zoom Link</a></p>` : ''}
                        <p style="margin-top:0.5rem;">${event.description.substring(0, 100)}${event.description.length > 100 ? '...' : ''}</p>
                    </div>
                `;
            }).join('');
        }
        
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        async function addEvent() {
            const newEvent = {
                id: Date.now().toString(),
                title: document.getElementById('title').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                eventType: document.getElementById('eventType').value,
                location: document.getElementById('location').value,
                zoomLink: document.getElementById('zoomLink').value,
                description: document.getElementById('description').value
            };
            
            events.push(newEvent);
            await saveEvents();
            
            // Clear form
            document.getElementById('eventForm').reset();
        }
        
        async function deleteEvent(index) {
            if (!confirm('Delete this event?')) return;
            events.splice(index, 1);
            await saveEvents();
        }
        
        async function saveEvents() {
            const status = document.getElementById('formStatus');
            status.style.display = 'block';
            status.className = 'status';
            status.textContent = 'Saving...';
            
            try {
                const content = JSON.stringify(events, null, 2);
                
                const body = {
                    message: 'Update events',
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: BRANCH
                };
                
                if (eventsFileSha) {
                    body.sha = eventsFileSha;
                }
                
                const response = await fetch(`https://api.github.com/repos/${REPO}/contents/${EVENTS_FILE}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    eventsFileSha = data.content.sha;
                    status.className = 'status success';
                    status.textContent = '‚úÖ Saved! Site updating...';
                    renderEvents();
                } else {
                    throw new Error('Save failed');
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = '‚ùå Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
